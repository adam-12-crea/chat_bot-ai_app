<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>R√©sum√© AI</title>
    <link rel="stylesheet" href="/static/dashboard.css">
    <style>
        .summary-container {
            max-width: 900px; margin: 40px auto; padding: 30px;
            background: rgba(30, 41, 59, 0.9); border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); color: white;
        }
        
        /* TABS */
        .tabs { display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid #475569; padding-bottom: 10px; }
        .tab-btn {
            background: none; border: none; color: #94a3b8; font-size: 1.1rem;
            cursor: pointer; padding: 10px 20px; transition: 0.2s; font-weight: bold;
        }
        .tab-btn.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
        
        /* INPUTS */
        .input-group { display: none; }
        .input-group.active { display: block; animation: fadeIn 0.3s; }
        
        textarea {
            width: 100%; height: 200px; background: #1e293b; color: white;
            border: 1px solid #475569; border-radius: 10px; padding: 15px;
            resize: vertical; font-family: 'Segoe UI', sans-serif;
        }

        .file-upload-box {
            border: 2px dashed #475569; padding: 40px; text-align: center;
            border-radius: 10px; cursor: pointer; transition: 0.2s;
            background: rgba(255,255,255,0.05);
        }
        .file-upload-box:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        
        /* CONTROLS */
        .controls { display: flex; gap: 20px; margin-top: 20px; align-items: center; }
        select { padding: 10px; border-radius: 8px; background: #334155; color: white; border: none; }
        
        .action-btn {
            background: #3b82f6; color: white; padding: 12px 30px;
            border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
            flex-grow: 1; transition: 0.2s;
        }
        .action-btn:hover { background: #2563eb; }
        
        /* RESULT */
        .result-box {
            margin-top: 30px; padding: 25px; background: #1e293b;
            border-radius: 10px; border: 1px solid #475569;
            min-height: 100px; display: none; line-height: 1.6;
        }
        .copy-btn { float: right; background: transparent; border: 1px solid #64748b; color: #cbd5e1; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .copy-btn:hover { background: white; color: black; }

        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    </style>
</head>
<body>
    <header class="dashboard-header">
    <div class="header-content">
        <div class="logo-container">
            <a href="{{ dashboard_link }}">
                <img src="/static/uir logo.png" class="logo" alt="UIR Logo">
            </a>
        </div>

        <div class="user-section">
            <a href="{{ dashboard_link }}" class="header-link">
                <i class="fas fa-home"></i> Accueil
            </a>
            
            {% if user_role == 'student' %}
            <a href="emploi-temps.html" class="header-link">
                <i class="fas fa-calendar-alt"></i> Emploi du temps
            </a>
            {% endif %}

            <a href="profil.html" class="header-link">
                <i class="fas fa-user"></i> Profil
            </a>

            <a href="/api/logout" class="header-link danger-btn">
                <i class="fas fa-sign-out-alt"></i> D√©connexion
            </a>
        </div>
    </div>
</header>
    <div class="background-overlay"></div>

    <div class="summary-container">
        <h1>üìù R√©sumeur Intelligent</h1>
        <p style="color: #94a3b8; margin-bottom: 20px;">Transformez vos cours en fiches de r√©vision instantan√©es.</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('text')">Coller Texte</button>
            <button class="tab-btn" onclick="switchTab('file')">Uploader Fichier</button>
        </div>

        <div id="tab-text" class="input-group active">
            <textarea id="rawText" placeholder="Collez votre cours ici..."></textarea>
        </div>

        <div id="tab-file" class="input-group">
            <div class="file-upload-box" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 2rem;">üìÇ</div>
                <p id="fileName">Cliquez pour ajouter un PDF</p>
                <input type="file" id="fileInput" hidden accept=".pdf">
            </div>
        </div>

        <div class="controls">
            <select id="summaryType">
                <option value="bullet_points">üìå Points Cl√©s (Liste)</option>
                <option value="paragraph">üìÑ Paragraphe R√©dig√©</option>
                <option value="concise">‚ö° R√©sum√© Flash (Court)</option>
            </select>
            <button class="action-btn" onclick="generateSummary()" id="genBtn">G√©n√©rer le R√©sum√©</button>
        </div>

        <div id="resultArea" class="result-box">
            <button class="copy-btn" onclick="copyToClipboard()">Copier</button>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        let currentMode = 'text';

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.input-group').forEach(g => g.classList.remove('active'));
            
            // Set active
            if(mode === 'text') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('tab-text').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('tab-file').classList.add('active');
            }
        }

        // File Display Name
        document.getElementById('fileInput').addEventListener('change', function() {
            if(this.files && this.files[0]) {
                document.getElementById('fileName').innerHTML = "‚úÖ " + this.files[0].name;
            }
        });

        async function generateSummary() {
            const btn = document.getElementById('genBtn');
            const resultBox = document.getElementById('resultArea');
            const contentBox = document.getElementById('summaryContent');
            
            btn.disabled = true;
            btn.innerText = "Analyse en cours...";
            resultBox.style.display = 'none';

            const formData = new FormData();
            formData.append('type', document.getElementById('summaryType').value);

            if(currentMode === 'text') {
                const text = document.getElementById('rawText').value;
                if(!text) return alert("Veuillez entrer du texte !");
                formData.append('text', text);
            } else {
                const file = document.getElementById('fileInput').files[0];
                if(!file) return alert("Veuillez choisir un fichier !");
                formData.append('file', file);
            }

            try {
                const res = await fetch('/api/summarize', {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();

                if(data.success) {
                    resultBox.style.display = 'block';
                    // Convert simple markdown to HTML (Bold and newlines)
                    let formatted = data.summary
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>');
                    contentBox.innerHTML = formatted;
                } else {
                    alert("Erreur: " + data.error);
                }
            } catch(e) {
                console.error(e);
                alert("Erreur de connexion.");
            }
            
            btn.disabled = false;
            btn.innerText = "G√©n√©rer le R√©sum√©";
        }

        function copyToClipboard() {
            const text = document.getElementById('summaryContent').innerText;
            navigator.clipboard.writeText(text);
            alert("Copi√© !");
        }
    </script>
</body>
</html>