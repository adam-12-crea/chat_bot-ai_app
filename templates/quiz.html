<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>GÃ©nÃ©rateur de Quiz</title>
    <link rel="stylesheet" href="/static/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .page-container { max-width: 800px; margin: 40px auto; padding: 20px; }
        .quiz-panel { background: #1e293b; border: 1px solid #334155; border-radius: 15px; padding: 40px; }
        
        /* LANGUAGE SELECTOR */
        .lang-wrapper { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .lang-btn {
            background: #0f172a; border: 1px solid #334155; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; color: #94a3b8; display: flex; gap: 8px; align-items: center;
        }
        .lang-btn.active { border-color: #3b82f6; color: white; background: rgba(59, 130, 246, 0.1); }
        .lang-btn img { width: 20px; height: 15px; border-radius: 2px; }

        .subjects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .subject-card {
            background: rgba(255,255,255,0.05); border: 2px solid #334155;
            padding: 15px; border-radius: 12px; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center;
        }
        .subject-card:hover { border-color: #3b82f6; }
        .subject-card input { display: none; }
        .subject-card:has(input:checked) { border-color: #3b82f6; background: #2563eb; }

        .diff-btn { flex: 1; padding: 15px; background: #0f172a; border: 1px solid #334155; color: #94a3b8; border-radius: 8px; cursor: pointer; text-align: center; }
        .diff-btn.active { color: white; border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }

        .start-btn { background: #22c55e; color: white; width: 100%; padding: 18px; border: none; border-radius: 12px; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>
    <header class="dashboard-header">
    <div class="header-content">
        <div class="logo-container">
            <a href="{{ dashboard_link }}">
                <img src="/static/uir logo.png" class="logo" alt="UIR Logo">
            </a>
        </div>

        <div class="user-section">
            <a href="{{ dashboard_link }}" class="header-link">
                <i class="fas fa-home"></i> Accueil
            </a>
            
            {% if user_role == 'student' %}
            <a href="emploi-temps.html" class="header-link">
                <i class="fas fa-calendar-alt"></i> Emploi du temps
            </a>
            {% endif %}

            <a href="profil.html" class="header-link">
                <i class="fas fa-user"></i> Profil
            </a>

            <a href="/api/logout" class="header-link danger-btn">
                <i class="fas fa-sign-out-alt"></i> DÃ©connexion
            </a>
        </div>
    </div>
</header>
    <div class="page-container">
        <div class="quiz-panel">
            <h1 style="color:white; text-align:center;">ðŸ§  EntraÃ®nement IA</h1>

            <label style="display:block; color:#94a3b8; margin-bottom:10px;">Langue du Quiz :</label>
            <div class="lang-wrapper">
                <div class="lang-btn active" onclick="setLang('French', this)">
                    <img src="https://flagcdn.com/w40/fr.png"> FranÃ§ais
                </div>
                <div class="lang-btn" onclick="setLang('English', this)">
                    <img src="https://flagcdn.com/w40/gb.png"> English
                </div>
            </div>
            <input type="hidden" id="selectedLang" value="French">
            
            <label style="display:block; color:#94a3b8; margin-bottom:10px;">MatiÃ¨re :</label>
            <div id="loadingMessage" style="color:#64748b;">Chargement...</div>
            <div class="subjects-grid" id="subjectsContainer"></div>

            <label style="display:block; color:#94a3b8; margin-bottom:10px;">DifficultÃ© :</label>
            <div style="display:flex; gap:20px; margin-bottom:30px;">
                <div class="diff-btn" onclick="selectDiff('Facile', this)">ðŸŸ¢ Facile</div>
                <div class="diff-btn active" onclick="selectDiff('Moyen', this)">ðŸŸ¡ Moyen</div>
                <div class="diff-btn" onclick="selectDiff('Difficile', this)">ðŸ”´ Difficile</div>
            </div>
            <input type="hidden" id="selectedDifficulty" value="Moyen">

            <button class="start-btn" id="startBtn" onclick="startQuiz()">ðŸš€ Commencer</button>
        </div>
    </div>

    <script>
        window.onload = async function() {
            try {
                const res = await fetch('/api/student/subjects');
                const subjects = await res.json();
                document.getElementById('loadingMessage').style.display = 'none';
                
                const container = document.getElementById('subjectsContainer');
                subjects.forEach((sub, i) => {
                    container.innerHTML += `
                    <label class="subject-card">
                        <input type="radio" name="subject" value="${sub}" ${i===0?'checked':''}>
                        <span>${sub}</span>
                    </label>`;
                });
            } catch (e) {}
        }

        function setLang(lang, btn) {
            document.getElementById('selectedLang').value = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function selectDiff(level, btn) {
            document.getElementById('selectedDifficulty').value = level;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        async function startQuiz() {
            const btn = document.getElementById('startBtn');
            const sub = document.querySelector('input[name="subject"]:checked');
            const diff = document.getElementById('selectedDifficulty').value;
            const lang = document.getElementById('selectedLang').value;

            if (!sub) return alert("SÃ©lectionnez une matiÃ¨re.");

            btn.disabled = true;
            btn.innerText = "GÃ©nÃ©ration...";

            try {
                const res = await fetch('/api/quiz/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ subject: sub.value, difficulty: diff, language: lang })
                });
                const data = await res.json();
                if(data.success) {
                    localStorage.setItem('currentQuizId', data.quiz_id);
                    window.location.href = 'quiz-taking.html';
                }
            } catch (e) { btn.disabled = false; }
        }
    </script>
</body>
</html>